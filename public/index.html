<!DOCTYPE html>
<html>
<head>
  <title>Chat App</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial;
      padding: 20px;
    }

    #chat {
      width: 100%;
      height: 70vh;
      overflow-y: auto;
      background: #222;
      padding: 10px;
      border-radius: 10px;
    }

    #inputBox {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }

    input {
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      border: none;
      outline: none;
    }

    button {
      padding: 10px 20px;
      background: #0a84ff;
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: bold;
    }

    button:hover {
      background: #0066cc;
    }
  </style>
</head>
<body>

<h2>My Chat App</h2>

<div id="chat"></div>

<div id="inputBox">
  <input id="input" placeholder="Type a message..." autocomplete="off" />
  <button id="send">Send</button>
</div>

<script>
let username = "";

// Ask for username immediately
while (!username) {
  username = prompt("Enter your username:");
}

const ws = new WebSocket(
  location.origin.replace(/^http/, "ws")
);

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");

sendBtn.onclick = send;
input.onkeydown = (e) => {
  if (e.key === "Enter") send();
};

function send() {
  const message = input.value.trim();
  if (!message) return;

  ws.send(JSON.stringify({
    username,
    message
  }));

  input.value = "";
}

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);

  const p = document.createElement("p");
  p.innerHTML =
    `<strong style="color:${data.color}">${data.username}:</strong> ${data.message}`;

  chat.appendChild(p);
  chat.scrollTop = chat.scrollHeight;
};
</script>

</body>
</html>
